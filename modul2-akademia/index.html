<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ•Šï¸ Przygoda OSI - Wielka Gra Sieciowa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 80vh;
        }

        .header {
            background: linear-gradient(90deg, #4A90E2, #357ABD);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 12px;
            border-radius: 6px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: #7ED321;
            height: 100%;
            border-radius: 6px;
            transition: width 0.8s ease;
            width: 0%;
        }

        .layer-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .layer-nav-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .layer-nav-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .layer-nav-btn.active {
            background: #7ED321;
            border-color: #7ED321;
            color: white;
        }

        .layer-nav-btn.completed {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .layer-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .content {
            padding: 40px;
            min-height: 500px;
        }

        .start-screen {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .start-screen h2 {
            color: #4A90E2;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .start-screen p {
            color: #666;
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .start-btn, .next-btn {
            background: linear-gradient(135deg, #4A90E2, #357ABD);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .start-btn:hover, .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .layer-icon {
            font-size: 6em;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .layer-title {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #4A90E2;
            line-height: 1.6;
        }

        .questions-section {
            background: #ffffff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .questions-title {
            color: #4A90E2;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .question {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4A90E2;
        }

        .question h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .answer-btn {
            display: block;
            width: 100%;
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
        }

        .answer-btn:hover {
            background: #f0f0f0;
            border-color: #4A90E2;
        }

        .answer-btn.correct {
            background: #d4edda;
            border-color: #4CAF50;
            color: #155724;
        }

        .answer-btn.incorrect {
            background: #f8d7da;
            border-color: #f44336;
            color: #721c24;
        }

        .reward-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            text-align: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .reward-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .reward-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .celebration {
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 50px;
            border-radius: 20px;
        }

        .certificate {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            border: 3px solid #4A90E2;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 10px;
            margin: 10px;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4A90E2;
        }

        .layer-1 { color: #E74C3C; }
        .layer-2 { color: #3498DB; }
        .layer-3 { color: #F39C12; }
        .layer-4 { color: #9B59B6; }
        .layer-5 { color: #1ABC9C; }
        .layer-6 { color: #E67E22; }
        .layer-7 { color: #2ECC71; }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .layer-title {
                font-size: 2em;
            }

            .layer-navigation {
                gap: 5px;
            }

            .layer-nav-btn {
                padding: 6px 10px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸ•Šï¸ Przygoda OSI</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="layer-navigation" id="layerNavigation">
                <!-- Dynamic navigation buttons -->
            </div>
        </div>

        <div class="content" id="gameContent">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Reward Popup -->
    <div class="reward-popup" id="rewardPopup">
        <div class="reward-icon" id="rewardIcon">ğŸ‰</div>
        <h2 id="rewardTitle" style="color: #4A90E2; margin-bottom: 15px;">Gratulacje!</h2>
        <p id="rewardText" style="font-size: 1.3em; margin-bottom: 20px;"></p>
        <p id="rewardSubText" style="color: #666; margin-bottom: 25px;"></p>
        <div id="rewardButtons"></div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <script>
        // Game state
        let currentLayer = 0;
        let completedLayers = [];
        let questionsAnswered = 0;
        let totalQuestions = 0;
        let gameStats = {
            startTime: new Date(),
            correctAnswers: 0,
            totalAttempts: 0,
            timeSpent: 0
        };

        // Layer data - 7 OSI layers adapted for Polish
        const layers = [
            {
                id: 1,
                title: "Warstwa Fizyczna - Kable i SygnaÅ‚y",
                icon: "ğŸ”Œ",
                color: "#E74C3C",
                badge: "Ekspert Fizyczny",
                explanation: `<strong>ğŸ”Œ Witaj w warstwie fizycznej!</strong><br>
                Nasza cyfrowa pocztÃ³wka zaczyna swojÄ… podrÃ³Å¼ tutaj - przy prawdziwych kablach, sygnaÅ‚ach WiFi i portach USB! 
                To tutaj bity (0 i 1) sÄ… zamieniane na sygnaÅ‚y elektryczne, Å›wiatÅ‚o lub fale radiowe.
                <br><br>
                <strong>ğŸŒŸ PrzykÅ‚ady:</strong> Kable Ethernet, anteny WiFi, kable USB, kable Å›wiatÅ‚owodowe.
                <br><strong>ğŸ“¡ WskazÃ³wka:</strong> Fizyczna = to czego moÅ¼na dotknÄ…Ä‡!`,
                questions: [
                    {
                        question: "ğŸ”Œ KtÃ³re z tych naleÅ¼y do warstwy fizycznej?",
                        answers: [
                            { text: "ğŸ“§ WysyÅ‚anie emaila", correct: false },
                            { text: "ğŸ”Œ Kabel USB", correct: true },
                            { text: "ğŸŒ Odwiedzanie strony internetowej", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ“¡ Co robi warstwa fizyczna?",
                        answers: [
                            { text: "ğŸ’¬ TÅ‚umaczy wiadomoÅ›ci", correct: false },
                            { text: "âš¡ Zamienia bity na sygnaÅ‚y elektryczne", correct: true },
                            { text: "ğŸ—ºï¸ Oblicza trasy", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "Warstwa ÅÄ…cza - Lokalne WiadomoÅ›ci",
                icon: "ğŸ“¦",
                color: "#3498DB",
                badge: "Detektyw ÅÄ…cza",
                explanation: `<strong>ğŸ“¦ Warstwa Å‚Ä…cza to jak lokalny listonosz!</strong><br>
                Ta warstwa zapewnia, Å¼e wiadomoÅ›ci dotrÄ… do bezpoÅ›rednich komputerÃ³w sÄ…siedzkich. 
                Dodaje adresy, aby komputery w tej samej sieci mogÅ‚y siÄ™ znaleÅºÄ‡.
                <br><br>
                <strong>ğŸ  PrzykÅ‚ady:</strong> Adresy MAC, ramki Ethernet, poÅ‚Ä…czenia WiFi.
                <br><strong>ğŸƒ WskazÃ³wka:</strong> ÅÄ…cze = dostarczanie paczek do bezpoÅ›rednich sÄ…siadÃ³w!`,
                questions: [
                    {
                        question: "ğŸ“¦ Dla kogo sÄ… przeznaczone paczki warstwy Å‚Ä…cza?",
                        answers: [
                            { text: "ğŸŒ Wszystkie komputery na Å›wiecie", correct: false },
                            { text: "ğŸ  Tylko bezpoÅ›rednie komputery sÄ…siedzkie", correct: true },
                            { text: "ğŸ“± Tylko smartfony", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ  Czym jest adres MAC?",
                        answers: [
                            { text: "ğŸ Komputer Apple", correct: false },
                            { text: "ğŸ†” Unikalny numer dla kaÅ¼dej karty sieciowej", correct: true },
                            { text: "ğŸ” HasÅ‚o", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "Warstwa Sieciowa - Wielka PodrÃ³Å¼",
                icon: "ğŸ—ºï¸",
                color: "#F39C12",
                badge: "Nawigator Sieciowy",
                explanation: `<strong>ğŸ—ºï¸ Warstwa sieciowa to jak GPS dla danych!</strong><br>
                Tutaj decyduje siÄ™, jakÄ… trasÄ™ powinna obraÄ‡ wiadomoÅ›Ä‡, aby dotrzeÄ‡ z twojego komputera do komputera daleko. 
                Adres IP jest uÅ¼ywany tutaj - to jak adres domowy kaÅ¼dego komputera.
                <br><br>
                <strong>ğŸŒ PrzykÅ‚ady:</strong> Adresy IP, routery, internet.
                <br><strong>ğŸ—ºï¸ WskazÃ³wka:</strong> Sieciowa = planowanie trasy na dÅ‚ugÄ… podrÃ³Å¼!`,
                questions: [
                    {
                        question: "ğŸ—ºï¸ Czym jest adres IP?",
                        answers: [
                            { text: "ğŸ” HasÅ‚o", correct: false },
                            { text: "ğŸ  Adres domowy komputera", correct: true },
                            { text: "ğŸ¦  Wirus", correct: false }
                        ]
                    },
                    {
                        question: "ğŸŒ Co robi router?",
                        answers: [
                            { text: "ğŸ“º Odtwarza filmy", correct: false },
                            { text: "ğŸ—ºï¸ Kieruje wiadomoÅ›ci we wÅ‚aÅ›ciwym kierunku", correct: true },
                            { text: "ğŸ”Œ Naprawia kable", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 4,
                title: "Warstwa Transportowa - Niezawodna Dostawa",
                icon: "ğŸš›",
                color: "#9B59B6",
                badge: "ÅšledzÄ…cy Transportu",
                explanation: `<strong>ğŸš› Warstwa transportowa to jak niezawodna firma kurierska!</strong><br>
                Ta warstwa zapewnia, Å¼e duÅ¼e wiadomoÅ›ci sÄ… dzielone na mniejsze kawaÅ‚ki i Å¼e wszystkie kawaÅ‚ki dotrÄ…. 
                To jak dzielenie wielkiej ukÅ‚adanki na maÅ‚e kawaÅ‚ki do wysÅ‚ania.
                <br><br>
                <strong>ğŸ“¦ PrzykÅ‚ady:</strong> TCP (niezawodny), UDP (szybki), numery portÃ³w.
                <br><strong>ğŸš› WskazÃ³wka:</strong> Transport = dzielenie duÅ¼ych rzeczy na Å‚atwiejsze do wysÅ‚ania!`,
                questions: [
                    {
                        question: "ğŸš› Dlaczego duÅ¼e pliki sÄ… dzielone?",
                        answers: [
                            { text: "ğŸ”’ Dla bezpieczeÅ„stwa", correct: false },
                            { text: "ğŸ“¦ Tak jest Å‚atwiej je wysÅ‚aÄ‡", correct: true },
                            { text: "ğŸ’¾ Å»eby zaoszczÄ™dziÄ‡ miejsce", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ”¢ Czym jest numer portu?",
                        answers: [
                            { text: "ğŸšª Numer twoich drzwi wejÅ›ciowych", correct: false },
                            { text: "ğŸ“¬ KtÃ³ra usÅ‚uga powinna otrzymaÄ‡ wiadomoÅ›Ä‡", correct: true },
                            { text: "ğŸ“ TwÃ³j numer telefonu", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 5,
                title: "Warstwa Sesji - Organizowanie RozmÃ³w",
                icon: "ğŸ¤",
                color: "#1ABC9C",
                badge: "Specjalista Sesji",
                explanation: `<strong>ğŸ¤ Warstwa sesji to jak prowadzÄ…cy rozmowy!</strong><br>
                Ta warstwa zapewnia, Å¼e rozmowy miÄ™dzy komputerami Å‚adnie siÄ™ zaczynajÄ…, trwajÄ… i koÅ„czÄ…. 
                Pilnuje kto rozmawia i reguluje, kto moÅ¼e mÃ³wiÄ‡ kiedy.
                <br><br>
                <strong>ğŸ’¬ PrzykÅ‚ady:</strong> Logowanie, rozpoczynanie/koÅ„czenie rozmÃ³w, podziaÅ‚ kolejek.
                <br><strong>ğŸ¤ WskazÃ³wka:</strong> Sesja = Å‚adne rozpoczÄ™cie i zakoÅ„czenie rozmowy!`,
                questions: [
                    {
                        question: "ğŸ¤ Co robi warstwa sesji?",
                        answers: [
                            { text: "ğŸ’¬ Organizuje rozmowy miÄ™dzy komputerami", correct: true },
                            { text: "ğŸ”Œ PodÅ‚Ä…cza kable", correct: false },
                            { text: "ğŸ—ºï¸ Oblicza trasy", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ” Kiedy warstwa sesji jest waÅ¼na?",
                        answers: [
                            { text: "ğŸ® Przy graniu w gry online", correct: false },
                            { text: "ğŸ”‘ Przy logowaniu na strony internetowe", correct: true },
                            { text: "ğŸ“º Przy oglÄ…daniu filmÃ³w", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 6,
                title: "Warstwa Prezentacji - TÅ‚umaczenie",
                icon: "ğŸŒ",
                color: "#E67E22",
                badge: "Mistrz Prezentacji",
                explanation: `<strong>ğŸŒ Warstwa prezentacji to jak Google Translate dla komputerÃ³w!</strong><br>
                Komputery czasami mÃ³wiÄ… rÃ³Å¼nymi 'jÄ™zykami' (formatami plikÃ³w). Ta warstwa zapewnia, Å¼e siÄ™ rozumiejÄ… poprzez tÅ‚umaczenie, szyfrowanie lub kompresjÄ™ wiadomoÅ›ci.
                <br><br>
                <strong>ğŸ”„ PrzykÅ‚ady:</strong> Szyfrowanie, kompresja (ZIP), rÃ³Å¼ne formaty plikÃ³w.
                <br><strong>ğŸŒ WskazÃ³wka:</strong> Prezentacja = tÅ‚umaczenie Å¼eby wszyscy rozumieli!`,
                questions: [
                    {
                        question: "ğŸŒ Co oznacza 'prezentacja' w tej warstwie?",
                        answers: [
                            { text: "ğŸ¨ Å»e komputery siÄ™ rozumiejÄ… (jak tÅ‚umaczenie)", correct: true },
                            { text: "âš¡ Å»e wiadomoÅ›ci szybko docierajÄ…", correct: false },
                            { text: "ğŸ—ºï¸ Å»e znajdowana jest trasa", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ—œï¸ Czym jest kompresja?",
                        answers: [
                            { text: "ğŸ“¦ Czynienie plikÃ³w mniejszymi, jak pakowanie ubraÅ„ do walizki", correct: true },
                            { text: "ğŸ” Szyfrowanie plikÃ³w", correct: false },
                            { text: "ğŸ“¤ WysyÅ‚anie plikÃ³w", correct: false }
                        ]
                    }
                ]
            },
            {
                id: 7,
                title: "Warstwa Aplikacji - Prawdziwa WiadomoÅ›Ä‡",
                icon: "ğŸ’Œ",
                color: "#2ECC71",
                badge: "Poszukiwacz PrzygÃ³d Aplikacji",
                explanation: `<strong>ğŸ’Œ Warstwa aplikacji to gdzie dzieje siÄ™ magia!</strong><br>
                To tutaj dzieje siÄ™ prawdziwa akcja: WhatsApp, gry, oglÄ…danie filmÃ³w. To co TY chcesz robiÄ‡! 
                Wszystkie inne warstwy wspÃ³Å‚pracujÄ…, aby umoÅ¼liwiÄ‡ tej warstwie dziaÅ‚anie.
                <br><br>
                <strong>ğŸ® PrzykÅ‚ady:</strong> WiadomoÅ›ci WhatsApp, filmy YouTube, gry online, email, strony internetowe.
                <br><strong>ğŸ’Œ WskazÃ³wka:</strong> Aplikacja = to co naprawdÄ™ chcesz robiÄ‡ z komputerem!`,
                questions: [
                    {
                        question: "ğŸ’Œ Co siÄ™ dzieje w warstwie aplikacji?",
                        answers: [
                            { text: "ğŸ“¦ WiadomoÅ›ci sÄ… pakowane", correct: false },
                            { text: "ğŸ®ğŸ’¬ Prawdziwe programy jak gry i WhatsApp", correct: true },
                            { text: "ğŸ—ºï¸ Trasy sÄ… obliczane", correct: false }
                        ]
                    },
                    {
                        question: "ğŸ¯ Dlaczego wszystkie inne warstwy wspÃ³Å‚pracujÄ… dla tej warstwy?",
                        answers: [
                            { text: "ğŸ® Å»ebyÅ› mÃ³gÅ‚ robiÄ‡ to co chcesz z komputerem", correct: true },
                            { text: "ğŸ¤– Bo komputery to lubiÄ…", correct: false },
                            { text: "ğŸ’¡ Å»eby oszczÄ™dzaÄ‡ energiÄ™", correct: false }
                        ]
                    }
                ]
            }
        ];

        // Final test questions (mixed from all layers)
        const finalTestQuestions = [
            {
                question: "ğŸ”Œ KtÃ³ra warstwa odpowiada za fizyczne poÅ‚Ä…czenie miÄ™dzy komputerami?",
                answers: [
                    { text: "Warstwa fizyczna", correct: true },
                    { text: "Warstwa aplikacji", correct: false },
                    { text: "Warstwa sieciowa", correct: false }
                ]
            },
            {
                question: "ğŸ—ºï¸ Czym jest adres IP?",
                answers: [
                    { text: "HasÅ‚o", correct: false },
                    { text: "Adres domowy komputera", correct: true },
                    { text: "Wirus", correct: false }
                ]
            },
            {
                question: "ğŸ“¦ Dla kogo sÄ… przeznaczone paczki warstwy Å‚Ä…cza?",
                answers: [
                    { text: "Wszystkie komputery na Å›wiecie", correct: false },
                    { text: "Tylko bezpoÅ›rednie komputery sÄ…siedzkie", correct: true },
                    { text: "Tylko smartfony", correct: false }
                ]
            },
            {
                question: "ğŸš› Dlaczego duÅ¼e pliki sÄ… dzielone?",
                answers: [
                    { text: "Dla bezpieczeÅ„stwa", correct: false },
                    { text: "Tak jest Å‚atwiej je wysÅ‚aÄ‡", correct: true },
                    { text: "Å»eby zaoszczÄ™dziÄ‡ miejsce", correct: false }
                ]
            },
            {
                question: "ğŸ® W ktÃ³rej warstwie znajdziesz WhatsApp i gry?",
                answers: [
                    { text: "Warstwa fizyczna", correct: false },
                    { text: "Warstwa transportowa", correct: false },
                    { text: "Warstwa aplikacji", correct: true }
                ]
            }
        ];

        // Initialize game
        function initGame() {
            showStartScreen();
            updateLayerNavigation();
            
            // Load saved progress
            const saved = localStorage.getItem('przygoda-osi-progress');
            if (saved) {
                const progress = JSON.parse(saved);
                completedLayers = progress.completed || [];
                currentLayer = progress.current || 0;
                gameStats = { ...gameStats, ...progress.stats };
            }
        }

        function showStartScreen() {
            const content = document.getElementById('gameContent');
            content.innerHTML = `
                <div class="start-screen">
                    <div style="font-size: 6em; margin-bottom: 30px;">ğŸ•Šï¸âœ¨</div>
                    <h2>Witaj w Przygodzie OSI!</h2>
                    <p>PomÃ³Å¼ naszej cyfrowej pocztÃ³wce dostarczyÄ‡ wiadomoÅ›Ä‡ przez sieÄ‡ komputerowÄ…! 
                    Odkryj jak komputery rozmawiajÄ… ze sobÄ… w 7 magicznych warstwach.</p>
                    <p>ğŸ¯ <strong>Cel:</strong> UkoÅ„cz wszystkie 7 warstw i zostaÅ„ prawdziwym odkrywcÄ… sieci!</p>
                    <button class="start-btn" onclick="startGame()">ğŸš€ Rozpocznij PrzygodÄ™!</button>
                    ${completedLayers.length > 0 ? `<br><button class="next-btn" onclick="continueGame()">ğŸ“– Kontynuuj gdzie skoÅ„czyÅ‚em</button>` : ''}
                </div>
            `;
        }

        function startGame() {
            currentLayer = 1;
            questionsAnswered = 0;
            gameStats.startTime = new Date();
            showLayer(1);
        }

        function continueGame() {
            if (completedLayers.length === 7) {
                showFinalTest();
            } else {
                showLayer(completedLayers.length + 1);
            }
        }

        function showLayer(layerNum) {
            currentLayer = layerNum;
            const layer = layers[layerNum - 1];
            questionsAnswered = 0;
            totalQuestions = layer.questions.length;
            
            updateProgress();
            updateLayerNavigation();
            
            const content = document.getElementById('gameContent');
            content.innerHTML = `
                <div class="layer-icon" style="color: ${layer.color}">${layer.icon}</div>
                <h2 class="layer-title layer-${layer.id}" style="color: ${layer.color}">Warstwa ${layer.id}: ${layer.title}</h2>
                
                <div class="explanation" style="border-left-color: ${layer.color}">
                    ${layer.explanation}
                </div>

                <div class="questions-section">
                    <h3 class="questions-title">ğŸ§  Przetestuj swojÄ… wiedzÄ™!</h3>
                    ${layer.questions.map((q, index) => `
                        <div class="question" id="question-${index}">
                            <h3>Pytanie ${index + 1}: ${q.question}</h3>
                            ${q.answers.map((answer, answerIndex) => `
                                <button class="answer-btn" onclick="checkAnswer(this, ${answer.correct}, ${index})">${answer.text}</button>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function checkAnswer(button, isCorrect, questionIndex) {
            const question = document.getElementById(`question-${questionIndex}`);
            const buttons = question.querySelectorAll('.answer-btn');
            
            gameStats.totalAttempts++;
            
            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                button.classList.add('correct');
                gameStats.correctAnswers++;
                questionsAnswered++;
                
                // Check if layer is complete
                if (questionsAnswered === totalQuestions) {
                    completedLayers.push(currentLayer);
                    saveProgress();
                    
                    setTimeout(() => {
                        if (currentLayer === 7) {
                            showFinalTest();
                        } else {
                            showReward();
                        }
                    }, 1000);
                }
            } else {
                button.classList.add('incorrect');
                
                // Show correct answer after 2 seconds
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('incorrect');
                    });
                }, 2000);
            }
        }

        function showReward() {
            const layer = layers[currentLayer - 1];
            
            document.getElementById('rewardIcon').textContent = layer.icon;
            document.getElementById('rewardTitle').textContent = 'Warstwa UkoÅ„czona!';
            document.getElementById('rewardText').innerHTML = `ZdobyÅ‚eÅ› odznakÄ™ "${layer.badge}"!`;
            
            if (currentLayer === 7) {
                document.getElementById('rewardSubText').innerHTML = 'UkoÅ„czyÅ‚eÅ› wszystkie 7 warstw! Czas na test koÅ„cowy...';
                document.getElementById('rewardButtons').innerHTML = `
                    <button class="next-btn" onclick="closeReward(); showFinalTest();">ğŸ† Do Testu KoÅ„cowego!</button>
                `;
            } else {
                document.getElementById('rewardSubText').innerHTML = `Wspaniale! Rozumiesz teraz warstwÄ™ ${currentLayer}. Gotowy na nastÄ™pne wyzwanie?`;
                document.getElementById('rewardButtons').innerHTML = `
                    <button class="next-btn" onclick="closeReward(); showLayer(${currentLayer + 1});">ğŸš€ Do Warstwy ${currentLayer + 1}!</button>
                    <br><button class="next-btn" onclick="closeReward(); showStartScreen();">ğŸ  PowrÃ³t do Startu</button>
                `;
            }
            
            document.getElementById('rewardPopup').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        function showFinalTest() {
            currentLayer = 8; // Special state for final test
            updateProgress();
            updateLayerNavigation();
            
            questionsAnswered = 0;
            totalQuestions = finalTestQuestions.length;
            
            const content = document.getElementById('gameContent');
            content.innerHTML = `
                <div class="layer-icon">ğŸ†</div>
                <h2 class="layer-title" style="color: #E74C3C">ğŸ“ Test KoÅ„cowy - Czy jesteÅ› Ekspertem OSI?</h2>
                
                <div class="explanation" style="border-left-color: #E74C3C">
                    <strong>ğŸ¯ Ostatnie wyzwanie!</strong><br>
                    NauczyÅ‚eÅ› siÄ™ wszystkich 7 warstw. Teraz sprawdzimy czy zostaÅ‚eÅ› prawdziwym ekspertem OSI! 
                    Te pytania pochodzÄ… ze wszystkich warstw pomieszanych.
                    <br><br>
                    <strong>ğŸ’ª Powodzenia!</strong> MoÅ¼esz to zrobiÄ‡!
                </div>

                <div class="questions-section">
                    <h3 class="questions-title">ğŸ§  Test KoÅ„cowy!</h3>
                    ${finalTestQuestions.map((q, index) => `
                        <div class="question" id="question-${index}">
                            <h3>Pytanie ${index + 1}: ${q.question}</h3>
                            ${q.answers.map((answer, answerIndex) => `
                                <button class="answer-btn" onclick="checkFinalAnswer(this, ${answer.correct}, ${index})">${answer.text}</button>
                            `).join('')}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function checkFinalAnswer(button, isCorrect, questionIndex) {
            const question = document.getElementById(`question-${questionIndex}`);
            const buttons = question.querySelectorAll('.answer-btn');
            
            gameStats.totalAttempts++;
            
            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                button.classList.add('correct');
                gameStats.correctAnswers++;
                questionsAnswered++;
                
                // Check if final test is complete
                if (questionsAnswered === totalQuestions) {
                    setTimeout(() => {
                        showCelebration();
                    }, 1000);
                }
            } else {
                button.classList.add('incorrect');
                
                // Show correct answer after 2 seconds
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('incorrect');
                    });
                }, 2000);
            }
        }

        function showCelebration() {
            gameStats.timeSpent = Math.round((new Date() - gameStats.startTime) / 60000);
            const accuracy = Math.round((gameStats.correctAnswers / gameStats.totalAttempts) * 100);
            
            // Notify parent window of completion
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'moduleCompleted',
                    module: 'przygoda-osi',
                    moduleName: 'Przygoda OSI'
                }, '*');
            }
            
            const content = document.getElementById('gameContent');
            content.innerHTML = `
                <div class="celebration">
                    <div style="font-size: 6em; margin-bottom: 30px;">ğŸ‰ğŸ†ğŸ‰</div>
                    <h2 style="color: #E74C3C; font-size: 3em; margin-bottom: 30px;">GRATULACJE!</h2>
                    
                    <div class="certificate">
                        <h3 style="font-size: 2.5em; margin-bottom: 20px; color: #4A90E2;">ğŸ† ODKRYWCA OSI ğŸ†</h3>
                        <p style="font-size: 1.5em; margin-bottom: 15px;">Ten certyfikat zostaje przyznany:</p>
                        <h2 style="font-size: 2em; color: #4A90E2; margin-bottom: 20px;">Poszukiwacz PrzygÃ³d OSI</h2>
                        <p style="font-size: 1.2em;">Za pomyÅ›lne ukoÅ„czenie wszystkich 7 warstw OSI<br>
                        i osiÄ…gniÄ™cie statusu eksperta!</p>
                        <p style="margin-top: 20px; font-size: 1em;">ğŸ•Šï¸ JesteÅ› teraz prawdziwym ekspertem sieci! ğŸ•Šï¸</p>
                    </div>

                    <div class="stats">
                        <div class="stat">
                            <div class="stat-number">${completedLayers.length}/7</div>
                            <div>Warstw UkoÅ„czonych</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number">${accuracy}%</div>
                            <div>DokÅ‚adnoÅ›Ä‡</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number">${gameStats.timeSpent}</div>
                            <div>Minut Gry</div>
                        </div>
                        <div class="stat">
                            <div class="stat-number">7</div>
                            <div>Odznak Zdobytych</div>
                        </div>
                    </div>

                    <h3 style="color: #4A90E2; margin: 30px 0 20px 0;">ğŸ–ï¸ Twoje Zdobyte Odznaki:</h3>
                    <div style="font-size: 1.5em; margin-bottom: 30px;">
                        ğŸ”Œ Ekspert Fizyczny â€¢ ğŸ“¦ Detektyw ÅÄ…cza â€¢ ğŸ—ºï¸ Nawigator Sieciowy â€¢ ğŸš› ÅšledzÄ…cy Transportu â€¢ ğŸ¤ Specjalista Sesji â€¢ ğŸŒ Mistrz Prezentacji â€¢ ğŸ’Œ Poszukiwacz PrzygÃ³d Aplikacji
                    </div>

                    <button class="start-btn" onclick="showStartScreen()">ğŸ  PowrÃ³t do Startu</button>
                </div>
            `;
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progress = (completedLayers.length / 7) * 100;
            progressFill.style.width = progress + '%';
        }

        function updateLayerNavigation() {
            const navigation = document.getElementById('layerNavigation');
            navigation.innerHTML = layers.map((layer, index) => {
                const layerNum = index + 1;
                const isCompleted = completedLayers.includes(layerNum);
                const isActive = layerNum === currentLayer;
                const isAccessible = layerNum <= completedLayers.length + 1;
                
                return `<button class="layer-nav-btn ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}" 
                    onclick="${isAccessible ? `showLayer(${layerNum})` : 'void(0)'}" 
                    ${!isAccessible ? 'disabled' : ''}>
                    ${layer.icon} ${layerNum}
                </button>`;
            }).join('') + 
            (completedLayers.length === 7 ? 
                `<button class="layer-nav-btn ${currentLayer === 8 ? 'active' : 'completed'}" onclick="showFinalTest()">ğŸ† Test</button>` : 
                '');
        }

        function saveProgress() {
            localStorage.setItem('przygoda-osi-progress', JSON.stringify({
                completed: completedLayers,
                current: currentLayer,
                stats: gameStats
            }));
        }

        function closeReward() {
            document.getElementById('rewardPopup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>